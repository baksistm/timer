<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Timer com Notificação</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0f172a, #020617);
    color: #fff;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .container {
    background: #020617;
    border-radius: 16px;
    padding: 30px;
    width: 320px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,.5);
  }

  .container h1 {
    font-size: 1.4rem;
    margin-bottom: 20px;
  }

  input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    margin-bottom: 15px;
    font-size: 1rem;
    text-align: center;
  }

  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 10px;
    background: #38bdf8;
    color: #020617;
    font-weight: bold;
    cursor: pointer;
    transition: .3s;
  }

  button:hover {
    background: #0ea5e9;
  }

  /* POPUP */
  .popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .popup-box {
    background: #020617;
    padding: 30px;
    border-radius: 18px;
    text-align: center;
    max-width: 320px;
    animation: zoom .3s ease;
  }

  .popup-box img {
    width: 120px;
    margin-bottom: 15px;
  }

  .popup-box h2 {
    font-size: 1.3rem;
    margin-bottom: 15px;
  }

  .popup-box button {
    background: #22c55e;
    color: #022c22;
  }

  @keyframes zoom {
    from { transform: scale(.8); opacity: 0 }
    to { transform: scale(1); opacity: 1 }
  }
</style>
</head>

<body>

<div class="container">
  <h1>⏱ Criar Timer</h1>
  <input type="number" id="time" placeholder="Tempo em segundos">
  <button onclick="startTimer()">Iniciar</button>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
  <div class="popup-box">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAA0lBMVEUAYJL///8AXpEAWo8AXJAAX5EAWI4AVo0AQ4QAU4sAUIoAUosATIj7/f4ATokAYpPA0d+vwtImZpUAPoKOrcXH1eDb5OwvYZRBdJ4ASIYkYJL1+fu4ydhKe6Hm6/Ds9PghbJlUeKJLcJ3Q3eZkhauHo72hus4AQYN6obxYhakAM31rkbAAOH9Sd6HU4uqkvM9hk7Rrj7A2ZZZ7mbaAoro4gKdum7g6bptzkbKUtMlciaxigKiEnLktW5KRqcFeeaQAK3oddKAAIXhyiK2hv9FKapsmdaiXAAARJklEQVR4nO2cC3eiOtfHIQmJ3ESoIMjNFqFlnOpYO0Vs63ne95nz/b/SG8BLsJ0Zx3amznrzX+usMwKm+bGTnb1zURC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLj+v8pg9NF1eWdJACBIFM3zOrU8T1MIgQABSfrour1dFA5h9dn6cp8F0zj2K8XTnpnef7UGyjOGEFLQj67l6QIQDu5WsyQWX5Pv2OZD+O9gCCBG4KPreooQtm4fev6GR9d1vxH9F8MZO+ZNflsM/zpKA2BrbDbG8+MoSYLZLFunabrOZjPTtqdOFPt7TLucPBYCJn8PpUGGK7MmiJMgW+SGrFUeptvtVg7HU8kon6drs5dE8dagUS9bPBZYhn9FtwTyVVbZz5+aTyGkrpPahh0tgISw3NUUw52nWZBE/rZnBuu5ixUonPt4AkhuVzW21yFSMHi9vtWwCKDcVa1wuTbtqLGlHtnZwlUV9Kfr/EsCeDKllXX6rkrAT6xRYWKZCO4yNacbU8bJbGF0yPka0lBzh9bTfCT42G9UxsTUlmXSQOqxneWad66tldxWTbS0yC/6RYQJuBr3k11zTUeaKp0hIxjOaAX7AJ7yXUjAXV46W8djrtQuOjtGPKdedDY81VXQOAgN8s1IqsdJKnj4vEJ1VATUibrHdsHXRGNZ8nyTbGKhaDa6ls+pQ5JHX4yX6htLkQDxRrNNPOv3wk/y2SBK6F4UA+s9hjPodSfTTcTjrK7JmcQ66M4W/afuu7xxAyheGGwMGU26GJ0DJLyKxSR8Sy9kZQjk2jU34Y6zGKAzYISXvhhI75kh4Asrc5pAYJoW6MMDc/hFFLPu+5aJrhlGF54y0L6jKKGfvk83ZIQ6o3UT0OlJ6hL4kY6VEsbv5Gja5XbdLaP9ZHU/MJj7XYS0ZJUy6s34uCDqhyHiR/03EVJGEq6bkDU2x95HdUc6WvyGfrgRwOgya8ZHJyu8n+Wev0fwynl3X8pIIsNLU9+4HPzW2PAkAcsUTfj7ZswMRAZ5sglX8+4HeFWAbkS7+K2zLAg/3zRNNcqGyp8PAPDYd8bk9/4NRIbmJiKfaH88Q4ZFov8uZ7oX6n7dTASY2p/ujRLqi6bx+ycDZa3fBOTxV+33/DUJVHqlF5Bx5Dy+vZlKEPzQXxnAczfTAN+e3921AQAR"/>
    <h2>⏰ Seu tempo acabou</h2>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
  const popup = document.getElementById('popup');

  // SERVICE WORKER INLINE
  if ('serviceWorker' in navigator) {
    const swCode = `
      self.addEventListener('notificationclick', e => {
        e.notification.close();
        self.clients.openWindow('/');
      });
    `;
    const blob = new Blob([swCode], { type: 'text/javascript' });
    const swURL = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swURL);
  }

  // PEDIR PERMISSÃO
  if (Notification.permission !== 'granted') {
    Notification.requestPermission();
  }

  function startTimer() {
    const seconds = Number(document.getElementById('time').value);
    if (!seconds || seconds <= 0) {
      alert('Digite um tempo válido');
      return;
    }

    setTimeout(() => {
      showPopup();
      sendNotification();
    }, seconds * 1000);
  }

  function showPopup() {
    popup.style.display = 'flex';
  }

  function closePopup() {
    popup.style.display = 'none';
  }

  function sendNotification() {
    if (Notification.permission === 'granted') {
      navigator.serviceWorker.ready.then(reg => {
        reg.showNotification('⏰ Seu tempo acabou', {
          body: 'O tempo do seu timer chegou ao fim.',
          icon: document.querySelector('.popup-box img').src
        });
      });
    }
  }
</script>

</body>
</html>
